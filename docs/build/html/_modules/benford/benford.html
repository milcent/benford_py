

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>benford.benford &mdash; benford_py 0.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> benford_py
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">benford</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">benford_py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>benford.benford</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for benford.benford</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="n">ones</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">mean</span> 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">confs</span><span class="p">,</span> <span class="n">digs_dict</span><span class="p">,</span> <span class="n">sec_order_dict</span><span class="p">,</span> <span class="n">rev_digs</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> \
    <span class="n">mad_dict</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">crit_chi2</span><span class="p">,</span> <span class="n">KS_crit</span>
<span class="kn">from</span> <span class="nn">.checks</span> <span class="kn">import</span> <span class="n">_check_digs_</span><span class="p">,</span> <span class="n">_check_confidence_</span><span class="p">,</span> <span class="n">_check_test_</span><span class="p">,</span> \
    <span class="n">_check_num_array_</span><span class="p">,</span> <span class="n">_check_high_Z_</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span>  <span class="n">_set_N_</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prepare</span><span class="p">,</span> \
    <span class="n">subtract_sorted</span><span class="p">,</span> <span class="n">prep_to_roll</span><span class="p">,</span> <span class="n">mad_to_roll</span><span class="p">,</span> <span class="n">mse_to_roll</span><span class="p">,</span> \
     <span class="n">get_mantissas</span>
<span class="kn">from</span> <span class="nn">.expected</span> <span class="kn">import</span> <span class="n">First</span><span class="p">,</span> <span class="n">Second</span><span class="p">,</span> <span class="n">LastTwo</span><span class="p">,</span> <span class="n">_test_</span>
<span class="kn">from</span> <span class="nn">.viz</span> <span class="kn">import</span> <span class="n">_get_plot_args</span><span class="p">,</span> <span class="n">plot_digs</span><span class="p">,</span> <span class="n">plot_sum</span><span class="p">,</span> <span class="n">plot_ordered_mantissas</span><span class="p">,</span>\
    <span class="n">plot_mantissa_arc_test</span>
<span class="kn">from</span> <span class="nn">.reports</span> <span class="kn">import</span> <span class="n">_inform_</span><span class="p">,</span> <span class="n">_report_mad_</span><span class="p">,</span> <span class="n">_report_summ_</span><span class="p">,</span> <span class="n">_report_KS_</span><span class="p">,</span>\
    <span class="n">_report_Z_</span><span class="p">,</span> <span class="n">_report_chi2_</span><span class="p">,</span> <span class="n">_report_test_</span><span class="p">,</span> <span class="n">_deprecate_inform_</span><span class="p">,</span>\
    <span class="n">_report_mantissa_</span>
<span class="kn">from</span> <span class="nn">.stats</span> <span class="kn">import</span> <span class="n">Z_score</span><span class="p">,</span> <span class="n">chi_square</span><span class="p">,</span> <span class="n">chi_square_2</span><span class="p">,</span> <span class="n">KS</span><span class="p">,</span> <span class="n">KS_2</span><span class="p">,</span> \
    <span class="n">mad</span><span class="p">,</span> <span class="n">mse</span>

<div class="viewcode-block" id="Base"><a class="viewcode-back" href="../../api.html#benford.benford.Base">[docs]</a><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internalizes and prepares the data for Analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.`</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        TypeError: if not receiving `int` or `float` as input.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sec_order</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">DataFrame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Seq&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;int64&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The sequence dtype was not pandas int64 nor &quot;</span>
                            <span class="s2">&quot;float64. Convert it to whether int of float, &quot;</span>
                            <span class="s2">&quot;and try again.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;int64&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">decimals</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span>\
                               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>\
                               <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>\
                               <span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ab</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># First digits</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;F1D&#39;</span><span class="p">,</span> <span class="s1">&#39;F2D&#39;</span><span class="p">,</span> <span class="s1">&#39;F3D&#39;</span><span class="p">]:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">rev_digs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span> <span class="o">-</span>
                                        <span class="p">(</span><span class="n">rev_digs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="c1"># fill NANs with -1, which is a non-usable value for digits,</span>
            <span class="c1"># to be discarded later.</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Second digit</span>
        <span class="n">temp_sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_sd</span><span class="o">.</span><span class="n">ZN</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">temp_sd</span><span class="o">.</span><span class="n">ZN</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span>
                                         <span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Last two digits</span>
        <span class="n">temp_l2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_l2d</span><span class="o">.</span><span class="n">ZN</span> <span class="o">%</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>


<div class="viewcode-block" id="Test"><a class="viewcode-back" href="../../api.html#benford.benford.Test">[docs]</a><span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transforms the original number sequence into a DataFrame reduced</span>
<span class="sd">    by the ocurrences of the chosen digits, creating other computed</span>
<span class="sd">    columns</span>

<span class="sd">    Args:</span>
<span class="sd">        base: The Base object with the data prepared for Analysis</span>
<span class="sd">        digs: Tells which test to perform: 1: first digit; 2: first two digits;</span>
<span class="sd">            3: furst three digits; 22: second digit; -2: last two digits.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show.</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">                the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        N: Number of records in the sample to consider in computations</span>
<span class="sd">        ddf: Degrees of Freedom to look up for the critical chi-square value</span>
<span class="sd">        chi_square: Chi-square statistic for the given test</span>
<span class="sd">        KS: Kolmogorov-Smirnov statistic for the given test</span>
<span class="sd">        MAD: Mean Absolute Deviation for the given test</span>
<span class="sd">        confidence: Confidence level to consider when setting some critical values</span>
<span class="sd">        digs (int): numerical representation of the test at hand. 1: F1D; 2: F2D;</span>
<span class="sd">            3: F3D; 22: SD; -2: L2D.</span>
<span class="sd">        sec_order (bool): True if the test is a Second Order one </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">digs</span><span class="p">,</span> <span class="n">confidence</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sec_order</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># create a separated Expected distributions object</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Test</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">_test_</span><span class="p">(</span><span class="n">digs</span><span class="p">))</span>
        <span class="c1"># create column with occurrences of the digits in the base</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="c1"># create column with relative frequencies</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># create column with absolute differences</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Dif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Found</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expected</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AbsDif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dif</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">_set_N_</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="n">limit_N</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Z_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chi_square</span> <span class="o">=</span> <span class="n">chi_square_2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KS</span> <span class="o">=</span> <span class="n">KS_2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AbsDif</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">confidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digs</span> <span class="o">=</span> <span class="n">digs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sec_order</span> <span class="o">=</span> <span class="n">sec_order</span>

        <span class="k">if</span> <span class="n">sec_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">sec_order_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]]</span>
    
<div class="viewcode-block" id="Test.update_confidence"><a class="viewcode-back" href="../../api.html#benford.benford.Test.update_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">update_confidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_conf</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a new confidence level for the Benford object, so as to be used to</span>
<span class="sd">        produce critical values for the tests</span>

<span class="sd">        Args:</span>
<span class="sd">            new_conf: new confidence level to draw lower and upper limits when</span>
<span class="sd">                plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">                calculate critical values for the tests&#39; statistics.</span>
<span class="sd">            check: checks the value provided for the confidence. Defaults to True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">new_conf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">new_conf</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">critical_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dict: a dictionary with the critical values for the test at hand,</span>
<span class="sd">            according to the current confidence level.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">confs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">],</span>
                <span class="s1">&#39;KS&#39;</span><span class="p">:</span> <span class="n">KS_crit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">),</span>
                <span class="s1">&#39;chi2&#39;</span><span class="p">:</span> <span class="n">crit_chi2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ddf</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">],</span>
                <span class="s1">&#39;MAD&#39;</span><span class="p">:</span> <span class="n">mad_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">digs</span><span class="p">]</span>
                <span class="p">}</span>

<div class="viewcode-block" id="Test.show_plot"><a class="viewcode-back" href="../../api.html#benford.benford.Test.show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the test plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">text_x</span> <span class="o">=</span> <span class="n">_get_plot_args</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digs</span><span class="p">)</span>
        <span class="n">plot_digs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y_Exp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Expected</span><span class="p">,</span> <span class="n">y_Found</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Found</span><span class="p">,</span>
                    <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">conf_Z</span><span class="o">=</span><span class="n">confs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">],</span>
                    <span class="n">text_x</span><span class="o">=</span><span class="n">text_x</span>
                    <span class="p">)</span></div>

<div class="viewcode-block" id="Test.report"><a class="viewcode-back" href="../../api.html#benford.benford.Test.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles the report especific to the test, considering its statistics</span>
<span class="sd">        and according to the current confidence level.</span>

<span class="sd">        Args:</span>
<span class="sd">            high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">                according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">                which will highlight only values higher than the expexted</span>
<span class="sd">                frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">                negative); and an integer, which will use the first n entries,</span>
<span class="sd">                positive and negative, regardless of whether Z is higher than</span>
<span class="sd">                the critical value or not.</span>
<span class="sd">            show_plot: calls the show_plot method, to draw the test plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">high_Z</span> <span class="o">=</span> <span class="n">_check_high_Z_</span><span class="p">(</span><span class="n">high_Z</span><span class="p">)</span>
        <span class="n">_report_test_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">high_Z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="Summ"><a class="viewcode-back" href="../../api.html#benford.benford.Summ">[docs]</a><span class="k">class</span> <span class="nc">Summ</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Gets the base object and outputs a Summation test object</span>

<span class="sd">    Args:</span>
<span class="sd">       base: The Base object with the data prepared for Analysis</span>
<span class="sd">       test: The test for which to compute the summation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Summ</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
                                   <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">test</span><span class="p">)[[</span><span class="s1">&#39;Seq&#39;</span><span class="p">]]</span>
                                   <span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sum&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;AbsDif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Percent</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1">#: Mean Absolute Deviation for the test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AbsDif</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1">#: Confidence level to consider when setting some critical values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># (int): numerical representation of the test at hand </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digs</span> <span class="o">=</span> <span class="n">rev_digs</span><span class="p">[</span><span class="n">test</span><span class="p">]</span>
        <span class="c1"># (str): the name of the Summation test. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{test}</span><span class="s1">_Summ&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Summ.show_plot"><a class="viewcode-back" href="../../api.html#benford.benford.Summ.show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draws the Summation test plot&quot;&quot;&quot;</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plot_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Summ.report"><a class="viewcode-back" href="../../api.html#benford.benford.Summ.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">high_diff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gives the report on the Summation test.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            high_diff: Number of records to show after ordering by the absolute</span>
<span class="sd">                differences between the found and the expected proportions      </span>
<span class="sd">            show_plot: calls the show_plot method, to draw the Summation test plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_report_test_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">high_diff</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span></div></div>

<span class="k">class</span> <span class="nc">Mantissas</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes and holds the mantissas of the logarithms of the records</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence to compute mantissas from. numpy 1D array, pandas</span>
<span class="sd">            Series of pandas DataFrame column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">_check_num_array_</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        <span class="c1">#: (DataFrame): pandas DataFrame with the mantissas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Mantissa&#39;</span><span class="p">:</span> <span class="n">get_mantissas</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">())})</span>
        <span class="c1"># (dict): Dictionary with the mantissas statistics </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mean&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                      <span class="s1">&#39;Var&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span>
                      <span class="s1">&#39;Skew&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">skew</span><span class="p">(),</span>
                      <span class="s1">&#39;Kurt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">kurt</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays the Mantissas test stats.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_plot: shows the Ordered Mantissas plot and the Arc Test plot.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_report_mantissa_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arc_test</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Plots the ordered mantissas and a line with the expected</span>
<span class="sd">        inclination.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize (tuple): figure size dimensions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot_ordered_mantissas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">arc_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds two columns to Mantissas&#39;s DataFrame equal to their &quot;X&quot; and &quot;Y&quot;</span>
<span class="sd">        coordinates, plots its to a scatter plot and calculates the gravity</span>
<span class="sd">        center of the circle.</span>

<span class="sd">        Args:</span>
<span class="sd">            decimals: number of decimal places for displaying the gravity center.</span>
<span class="sd">                Defaults to 2.</span>
<span class="sd">            grid: show grid of the plot. Defaluts to True.</span>
<span class="sd">            figsize (int): size of the figure to be displayed. Since it is a square,</span>
<span class="sd">                there is no need to provide a tuple, like is usually the case with</span>
<span class="sd">                matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gravity_center&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mant_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mant_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;gravity_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mant_x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mant_y</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        
        <span class="n">plot_mantissa_arc_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> 
                               <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

<div class="viewcode-block" id="Benford"><a class="viewcode-back" href="../../api.html#benford.benford.Benford">[docs]</a><span class="k">class</span> <span class="nc">Benford</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes a Benford Analysis object and computes the proportions for</span>
<span class="sd">    the digits. The tets dataFrames are atributes, i.e., obj.F1D is the First</span>
<span class="sd">    Digit DataFrame, the obj.F2D,the First Two Digits one, and so one, F3D for</span>
<span class="sd">    First Three Digits, SD for Second  Digit and L2D for Last Two Digits.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a tuple with a pandas DataFrame and the name (str)</span>
<span class="sd">            of the chosen column. Values must be integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">            calculate critical values for the tests&#39; statistics. Defaults to 95.</span>
<span class="sd">        sec_order: runs the Second Order tests, which are the Benford&#39;s tests</span>
<span class="sd">            performed on the differences between the ordered sample (a value minus</span>
<span class="sd">            the one before it, and so on). If the original series is Benford-</span>
<span class="sd">            compliant, this new sequence should aldo follow Beford. The Second</span>
<span class="sd">            Order can also be called separately, through the method sec_order().</span>
<span class="sd">        summation: creates the Summation DataFrames for the First, First Two, and</span>
<span class="sd">            First Three Digits. The summation tests can also be called separately,</span>
<span class="sd">            through the method summation().</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">            the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">        verbose: gives some information about the data and the registries used</span>
<span class="sd">            and discarded for each test.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        data: the raw data provided for the analysis</span>
<span class="sd">        chosen: the column of the DataFrame to be analysed or the data itself</span>
<span class="sd">        sign (str): which number sign(s) to include in the analysis</span>
<span class="sd">        confidence: current confidence level</span>
<span class="sd">        limit_N (int): sample size to use in computations</span>
<span class="sd">        verbose (bool): verbose or not</span>
<span class="sd">        base: the Base, pre-processed object</span>
<span class="sd">        tests (:obj:`list` of :obj:`str`): keeps track of the tests the</span>
<span class="sd">            instance has</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span>
                 <span class="n">mantissas</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sec_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">summation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span> <span class="o">=</span> <span class="n">decimals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sign</span> <span class="o">=</span> <span class="n">sign</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit_N</span> <span class="o">=</span> <span class="n">limit_N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">Base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create a DatFrame for each Test</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">digs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">Test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">digs</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
                        <span class="n">limit_N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit_N</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1"># dict with the numbers of discarded entries for each test column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_discarded</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span>
                           <span class="nb">zip</span><span class="p">(</span><span class="n">digs_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                               <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">digs_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; Benford Object Instantiated &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Initial sample size: {len(self.chosen)}.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test performed on {len(self.base)} registries.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of discarded entries for each test:</span><span class="se">\n</span><span class="si">{self._discarded}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mantissas</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mantissas</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="n">sec_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sec_order</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">summation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summation</span><span class="p">()</span>
    
<div class="viewcode-block" id="Benford.update_confidence"><a class="viewcode-back" href="../../api.html#benford.benford.Benford.update_confidence">[docs]</a>    <span class="k">def</span> <span class="nf">update_confidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_conf</span><span class="p">,</span> <span class="n">tests</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets (a) new confidence level(s) for the Benford object, so as to be</span>
<span class="sd">        used to produce critical values for the tests.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_conf: new confidence level to draw lower and upper limits when</span>
<span class="sd">                plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">                calculate critical values for the tests&#39; statistics.</span>
<span class="sd">            tests (:obj:`list` of :obj:`str`): list of tests names (strings) to</span>
<span class="sd">                have their confidence updated. If only one, provide a one-element</span>
<span class="sd">                list, like [&#39;F1D&#39;]. Defauts to None, in which case it will use</span>
<span class="sd">                the instance .test list attribute.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the test argument is not a `list` or `None`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">new_conf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tests</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;tests must be a list or None.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">update_confidence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Mantissas&#39;</span><span class="p">,</span> <span class="s1">&#39;F1D_Summ&#39;</span><span class="p">,</span> <span class="s1">&#39;F2D_Summ&#39;</span><span class="p">,</span> <span class="s1">&#39;F3D_Summ&#39;</span><span class="p">]:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{test}</span><span class="s2"> not in Benford instance tests - review test&#39;s name.&quot;</span><span class="p">)</span>
                    <span class="k">pass</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_confidences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dict: a dictionary with a confidence level for each computed tests,</span>
<span class="sd">        when applicable.&quot;&quot;&quot;</span>
        <span class="n">con_dic</span><span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">con_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">confidence</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">con_dic</span>

<div class="viewcode-block" id="Benford.mantissas"><a class="viewcode-back" href="../../api.html#benford.benford.Benford.mantissas">[docs]</a>    <span class="k">def</span> <span class="nf">mantissas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a Mantissas object to the tests, with all its statistics and</span>
<span class="sd">        plotting capabilities. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mantissas</span> <span class="o">=</span> <span class="n">Mantissas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Mantissas&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Added Mantissas test.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Benford.sec_order"><a class="viewcode-back" href="../../api.html#benford.benford.Benford.sec_order">[docs]</a>    <span class="k">def</span> <span class="nf">sec_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the Second Order tests, which are the Benford&#39;s tests</span>
<span class="sd">        performed on the differences between the ordered sample (a value minus</span>
<span class="sd">        the one before it, and so on). If the original series is Benford-</span>
<span class="sd">        compliant, this new sequence should aldo follow Beford. The Second</span>
<span class="sd">        Order can also be called separately, through the method sec_order().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: Base instance of the differences between the ordered sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_sec</span> <span class="o">=</span> <span class="n">Base</span><span class="p">(</span><span class="n">subtract_sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen</span><span class="p">),</span>
                             <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">digs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">Test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_sec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_sec</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">digs</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
                        <span class="n">limit_N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">sec_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sec_order_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">test</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{val}</span><span class="s1">_sec&#39;</span><span class="p">)</span>
            <span class="c1"># No need to populate crit_vals dict, since they are the</span>
            <span class="c1"># same and do not depend on N</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_discarded_sec</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                                   <span class="n">sec_order_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                                   <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_sec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span>
                                    <span class="n">digs_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Second order tests run in {len(self.base_sec)} &#39;</span>
                  <span class="s1">&#39;registries.</span><span class="se">\n\n</span><span class="s1">Number of discarded entries for second order&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39; tests:</span><span class="se">\n</span><span class="si">{self._discarded_sec}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Benford.summation"><a class="viewcode-back" href="../../api.html#benford.benford.Benford.summation">[docs]</a>    <span class="k">def</span> <span class="nf">summation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Summation test DataFrames from Base object&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;F1D&#39;</span><span class="p">,</span> <span class="s1">&#39;F2D&#39;</span><span class="p">,</span> <span class="s1">&#39;F3D&#39;</span><span class="p">]:</span>
            <span class="n">t</span> <span class="o">=</span>  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{test}</span><span class="s1">_Summ&#39;</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Summ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">test</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Added Summation DataFrames to F1D, F2D and F3D Tests.&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Source"><a class="viewcode-back" href="../../api.html#benford.benford.Source">[docs]</a><span class="k">class</span> <span class="nc">Source</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prepares the data for Analysis. pandas DataFrame subclass.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">        sec_order: choice for the Second Order Test, which cumputes the</span>
<span class="sd">            differences between the ordered entries before running the Tests.</span>
<span class="sd">        verbose: tells the number of registries that are being subjected to</span>
<span class="sd">            the analysis; defaults to True.</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the `sign` arg is not in [&#39;all&#39;, &#39;pos&#39;, &#39;neg&#39;]</span>
<span class="sd">        TypeError: if not receiving `int` or `float` as input.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sec_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">sign</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;neg&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The -sign- argument must be &quot;</span>
                             <span class="s2">&quot;&#39;all&#39;,&#39;pos&#39; or &#39;neg&#39;.&quot;</span><span class="p">)</span>

        <span class="n">DataFrame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Seq&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;float64&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;int64&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The sequence dtype was not pandas int64 nor float64.</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;Convert it to whether int64 of float64, and try again.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sign</span> <span class="o">==</span> <span class="s1">&#39;neg&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#: (bool): verbose or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initialized sequence with {len(self)} registries.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sec_order</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span> <span class="o">=</span> <span class="n">subtract_sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Second Order Test. Initial series reduced &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;to {len(self.Seq)} entries.&#39;</span><span class="p">)</span>

        <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;int64&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">decimals</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
                <span class="c1"># There is some numerical issue with Windows that required</span>
                <span class="c1"># implementing it differently (and slower)</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>\
                               <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>\
                               <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>\
                               <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;ZN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ab</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<div class="viewcode-block" id="Source.mantissas"><a class="viewcode-back" href="../../api.html#benford.benford.Source.mantissas">[docs]</a>    <span class="k">def</span> <span class="nf">mantissas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the mantissas, their mean and variance, and compares them</span>
<span class="sd">        with the mean and variance of a Benford&#39;s sequence.</span>

<span class="sd">        Args:</span>
<span class="sd">            report: prints the mamtissas mean, variance, skewness and kurtosis</span>
<span class="sd">                for the sequence studied, along with reference values.</span>
<span class="sd">            plot: plots the ordered mantissas and a line with the expected</span>
<span class="sd">                inclination. Defaults to True.</span>
<span class="sd">            figsize: tuple that sets the figure dimensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s1">&#39;Mant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_mantissas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;Seq&#39;</span><span class="p">,</span> <span class="s1">&#39;Mant&#39;</span><span class="p">]]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">Seq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Mant&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas MEAN is {p.Mant.mean()}. Ref: 0.5.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas VARIANCE is {p.Mant.var()}. Ref: 0.083333.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas SKEWNESS is {p.Mant.skew()}. </span><span class="se">\t</span><span class="s2">Ref: 0.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas KURTOSIS is {p.Mant.kurt()}. </span><span class="se">\t</span><span class="s2">Ref: -1.2.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">plot_ordered_mantissas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mant</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span></div>


<div class="viewcode-block" id="Source.first_digits"><a class="viewcode-back" href="../../api.html#benford.benford.Source.first_digits">[docs]</a>    <span class="k">def</span> <span class="nf">first_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digs</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span>
                     <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ret_df</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the Benford First Digits test with the series of</span>
<span class="sd">        numbers provided, and populates the mapping dict for future</span>
<span class="sd">        selection of the original series.</span>

<span class="sd">        Args:</span>
<span class="sd">            digs: number of first digits to consider. Must be 1 (first digit),</span>
<span class="sd">                2 (first two digits) or 3 (first three digits).</span>
<span class="sd">            verbose: tells the number of registries that are being subjected to</span>
<span class="sd">                the analysis; defaults to True</span>
<span class="sd">            digs: number of first digits to consider. Must be 1 (first digit),</span>
<span class="sd">                2 (first two digits) or 3 (first three digits).</span>
<span class="sd">            confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">                plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">                calculate critical values for the tests&#39; statistics. Defaults to None.</span>
<span class="sd">            high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">                according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">                which will highlight only values higher than the expexted</span>
<span class="sd">                frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">                negative); and an integer, which will use the first n entries,</span>
<span class="sd">                positive and negative, regardless of whether Z is higher than</span>
<span class="sd">                the confidence or not.</span>
<span class="sd">            limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">                the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">            MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">                found and the expected distributions; defaults to False.</span>
<span class="sd">            MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            show_plot: draws the test plot. Defaults to True.</span>
<span class="sd">            ret_df: returns the test DataFrame. Defaults to False. True if run by</span>
<span class="sd">                the test function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">                the differences</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check on the possible values for confidence levels</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
        <span class="c1"># Check on possible digits</span>
        <span class="n">_check_test_</span><span class="p">(</span><span class="n">digs</span><span class="p">)</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">digs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                                   <span class="nb">int</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">digs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                                       <span class="nb">int</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">digs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">digs</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">show_plot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]],</span> <span class="n">digs</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span>
                        <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]],</span> <span class="n">digs</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span>
                           <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test performed on {len(temp)} registries.</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;Discarded {len(self) - len(temp)} records &lt; {10 ** (digs - 1)}&quot;</span>
                  <span class="s2">&quot; after preparation.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_inform_</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="n">confs</span><span class="p">[</span><span class="n">confidence</span><span class="p">])</span>

        <span class="c1"># Mean absolute difference</span>
        <span class="k">if</span> <span class="n">MAD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MAD</span> <span class="o">=</span> <span class="n">mad</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">digs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Mean Square Error</span>
        <span class="k">if</span> <span class="n">MSE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MSE</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Chi-square statistic</span>
        <span class="k">if</span> <span class="n">chi_square</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi_square</span> <span class="o">=</span> <span class="n">chi_square</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># KS test</span>
        <span class="k">if</span> <span class="n">KS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">KS</span> <span class="o">=</span> <span class="n">KS</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Plotting the expected frequncies (line) against the found ones(bars)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plot_digs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y_Exp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Expected</span><span class="p">,</span> <span class="n">y_Found</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Found</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span>
                       <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">conf_Z</span><span class="o">=</span><span class="n">confs</span><span class="p">[</span><span class="n">confidence</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ret_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Source.second_digit"><a class="viewcode-back" href="../../api.html#benford.benford.Source.second_digit">[docs]</a>    <span class="k">def</span> <span class="nf">second_digit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span>
                     <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ret_df</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the Benford Second Digit test with the series of</span>
<span class="sd">        numbers provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose: tells the number of registries that are being subjected to</span>
<span class="sd">                the analysis; defaults to True</span>
<span class="sd">            MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">                found and the expected distributions; defaults to False.</span>
<span class="sd">            confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">                plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">                calculate critical values for the tests&#39; statistics. Defaults to None.</span>
<span class="sd">            high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">                according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">                which will highlight only values higher than the expexted</span>
<span class="sd">                frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">                negative); and an integer, which will use the first n entries,</span>
<span class="sd">                positive and negative, regardless of whether Z is higher than</span>
<span class="sd">                the confidence or not.</span>
<span class="sd">            limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">                the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">            MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            show_plot: draws the test plot.</span>
<span class="sd">            ret_df: returns the test DataFrame. Defaults to False. True if run by</span>
<span class="sd">                the test function.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">                the differences</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>

        <span class="n">conf</span> <span class="o">=</span> <span class="n">confs</span><span class="p">[</span><span class="n">confidence</span><span class="p">]</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span>
        <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                      <span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="mi">10</span>

        <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">show_plot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">],</span> <span class="mi">22</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">],</span> <span class="mi">22</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test performed on {len(temp)} registries.</span><span class="se">\n</span><span class="s2">Discarded &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;{len(self) - len(temp)} records &lt; 10 after preparation.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_inform_</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_Z</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

        <span class="c1"># Mean absolute difference</span>
        <span class="k">if</span> <span class="n">MAD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MAD</span> <span class="o">=</span> <span class="n">mad</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Mean Square Error</span>
        <span class="k">if</span> <span class="n">MSE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MSE</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Chi-square statistic</span>
        <span class="k">if</span> <span class="n">chi_square</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi_square</span> <span class="o">=</span> <span class="n">chi_square</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># KS test</span>
        <span class="k">if</span> <span class="n">KS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">KS</span> <span class="o">=</span> <span class="n">KS</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Plotting the expected frequncies (line) against the found ones(bars)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plot_digs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">y_Exp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Expected</span><span class="p">,</span>
                       <span class="n">y_Found</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Found</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">conf_Z</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Source.last_two_digits"><a class="viewcode-back" href="../../api.html#benford.benford.Source.last_two_digits">[docs]</a>    <span class="k">def</span> <span class="nf">last_two_digits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span>
                        <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ret_df</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the Benford Last Two Digits test with the series of</span>
<span class="sd">        numbers provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose: tells the number of registries that are being subjected to</span>
<span class="sd">                the analysis; defaults to True</span>
<span class="sd">            MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">                found and the expected distributions; defaults to False.</span>
<span class="sd">            confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">                plotting and to limit the top deviations to show, as well as to</span>
<span class="sd">                calculate critical values for the tests&#39; statistics. Defaults to None.</span>
<span class="sd">            high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">                according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">                which will highlight only values higher than the expexted</span>
<span class="sd">                frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">                negative); and an integer, which will use the first n entries,</span>
<span class="sd">                positive and negative, regardless of whether Z is higher than</span>
<span class="sd">                the confidence or not.</span>
<span class="sd">            limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">                the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">            MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            show_plot: draws the test plot.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">                the differences</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">_check_confidence_</span><span class="p">(</span><span class="n">confidence</span><span class="p">)</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">confs</span><span class="p">[</span><span class="n">confidence</span><span class="p">]</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">ZN</span> <span class="o">%</span> <span class="mi">100</span>

        <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">show_plot</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;L2D&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test performed on {len(temp)} registries.</span><span class="se">\n\n</span><span class="s2">Discarded &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;{len(self) - len(temp)} records &lt; 1000 after preparation&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_inform_</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">high_Z</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

        <span class="c1"># Mean absolute difference</span>
        <span class="k">if</span> <span class="n">MAD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MAD</span> <span class="o">=</span> <span class="n">mad</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Mean Square Error</span>
        <span class="k">if</span> <span class="n">MSE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MSE</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Chi-square statistic</span>
        <span class="k">if</span> <span class="n">chi_square</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chi_square</span> <span class="o">=</span> <span class="n">chi_square</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span>
                                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="c1"># KS test</span>
        <span class="k">if</span> <span class="n">KS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">KS</span> <span class="o">=</span> <span class="n">KS</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Plotting expected frequencies (line) versus found ones (bars)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plot_digs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">y_Exp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Expected</span><span class="p">,</span>
                       <span class="n">y_Found</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Found</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                       <span class="n">conf_Z</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span> <span class="n">text_x</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Source.summation"><a class="viewcode-back" href="../../api.html#benford.benford.Source.summation">[docs]</a>    <span class="k">def</span> <span class="nf">summation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">ret_df</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs the Summation test. In a Benford series, the sums of the</span>
<span class="sd">        entries begining with the same digits tends to be the same.</span>

<span class="sd">        Args:</span>
<span class="sd">            digs: tells the first digits to use. 1- first; 2- first two;</span>
<span class="sd">                3- first three. Defaults to 2.</span>
<span class="sd">            top: choses how many top values to show. Defaults to 20.</span>
<span class="sd">            show_plot: plots the results. Defaults to True.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with the Expected and Found proportions, and their</span>
<span class="sd">            absolute differences</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_check_digs_</span><span class="p">(</span><span class="n">digs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">digs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="c1"># Call the dict for F1D, F2D, F3D</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">digs_dict</span><span class="p">[</span><span class="n">digs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ZN</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="n">digs</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># Call the expected proportion according to digs</span>
        <span class="n">li</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">digs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># s.drop(0, inplace=True)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ZN</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">ZN</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Summ&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Summ&#39;</span><span class="p">,</span> <span class="s1">&#39;Percent&#39;</span><span class="p">]]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;AbsDif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Percent</span> <span class="o">-</span> <span class="n">li</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="c1"># N = len(self)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test performed on {len(self)} registries.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The top </span><span class="si">{top}</span><span class="s2"> diferences are:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[:</span><span class="n">top</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plot_sum</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
                       <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">digs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">li</span><span class="o">=</span><span class="n">li</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ret_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="Source.duplicates"><a class="viewcode-back" href="../../api.html#benford.benford.Source.duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_Rep</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Performs a duplicates test and maps the duplicates count in descending</span>
<span class="sd">        order.</span>

<span class="sd">        Args:</span>
<span class="sd">            verbose: tells how many duplicated entries were found and prints the</span>
<span class="sd">                top numbers according to the top_Rep argument. Defaluts to True.</span>
<span class="sd">            top_Rep: int or None. Chooses how many duplicated entries will be</span>
<span class="sd">                shown withe the top repititions. Defaluts to 20. If None, returns</span>
<span class="sd">                al the ordered repetitions.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame with the duplicated records and their occurrence counts,</span>
<span class="sd">                in descending order (if verbose is False; if True, prints to</span>
<span class="sd">                terminal).</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the `top_Rep` arg is not int or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">top_Rep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_Rep</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The top_Rep argument must be an int or None.&#39;</span><span class="p">)</span>

        <span class="n">dup</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[[</span><span class="s1">&#39;Seq&#39;</span><span class="p">]][</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="n">dup_count</span> <span class="o">=</span> <span class="n">dup</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Seq</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="n">dup_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Entries&#39;</span><span class="p">]</span>
        <span class="n">dup_count</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Seq&#39;</span><span class="p">:</span> <span class="s1">&#39;Count&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">dup_count</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># self.maps[&#39;dup&#39;] = dup_count.index[:top_Rep].values  # array</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Found {len(dup_count)} duplicated entries.</span><span class="se">\n</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;The entries with the </span><span class="si">{top_Rep}</span><span class="s1"> highest repitition counts are:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dup_count</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_Rep</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dup_count</span></div></div>


<div class="viewcode-block" id="Mantissas"><a class="viewcode-back" href="../../api.html#benford.benford.Mantissas">[docs]</a><span class="k">class</span> <span class="nc">Mantissas</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a Series with the data mantissas,</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence to compute mantissas from, numpy 1D array, pandas</span>
<span class="sd">            Series of pandas DataFrame column.</span>
<span class="sd">    Attributes:</span>
<span class="sd">        data (DataFrame): holds the computed mantissas and, if the arc_test</span>
<span class="sd">            is also called, the respecttive x and Y coordinates for the plot.</span>
<span class="sd">        stats (dict): holds the relevant statistics about the data mantissas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">_check_num_array</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Mantissa&#39;</span><span class="p">:</span> <span class="n">_getMantissas_</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">())})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mean&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                      <span class="s1">&#39;Var&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span>
                      <span class="s1">&#39;Skew&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">skew</span><span class="p">(),</span>
                      <span class="s1">&#39;Kurt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="o">.</span><span class="n">kurt</span><span class="p">()}</span>

<div class="viewcode-block" id="Mantissas.report"><a class="viewcode-back" href="../../api.html#benford.benford.Mantissas.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays the Mantissas stats.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_plot: shows the ordered mantissas plot and the Arc Test plot.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;  Mantissas Test  &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The Mantissas MEAN is      </span><span class="si">{self.stats[&#39;Mean&#39;]:.6f}</span><span class="s2">.&quot;</span>
              <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Ref: 0.5&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas VARIANCE is  </span><span class="si">{self.stats[&#39;Var&#39;]:.6f}</span><span class="s2">.&quot;</span>
              <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Ref: 0.08333&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas SKEWNESS is  </span><span class="si">{self.stats[&#39;Skew&#39;]:.6f}</span><span class="s2">.&quot;</span>
              <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Ref: 0.0&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The Mantissas KURTOSIS is  </span><span class="si">{self.stats[&#39;Kurt&#39;]:.6f}</span><span class="s2">.&quot;</span>
              <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Ref: -1.2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arc_test</span><span class="p">()</span></div>

<div class="viewcode-block" id="Mantissas.show_plot"><a class="viewcode-back" href="../../api.html#benford.benford.Mantissas.show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Plots the ordered mantissas and compares them to the expected, straight</span>
<span class="sd">        line that should be formed in a Benford-cmpliant set.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize: tuple that sets the figure size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot_ordered_mantissas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span></div>
 
<div class="viewcode-block" id="Mantissas.arc_test"><a class="viewcode-back" href="../../api.html#benford.benford.Mantissas.arc_test">[docs]</a>    <span class="k">def</span> <span class="nf">arc_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add two columns to Mantissas&#39;s DataFrame equal to their &quot;X&quot; and &quot;Y&quot;</span>
<span class="sd">        coordinates, plots its to a scatter plot and calculates the gravity</span>
<span class="sd">        center of the circle.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid:show grid of the plot. Defaluts to True.</span>
<span class="sd">            figsize: size of the figure to be displayed. Since it is a square,</span>
<span class="sd">                there is no need to provide a tuple, like is usually the case with</span>
<span class="sd">                matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gravity_center&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mant_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mant_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Mantissa</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;gravity_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mant_x</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mant_y</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">plot_mantissa_arc_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;gravity_center&#39;</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Roll_mad"><a class="viewcode-back" href="../../api.html#benford.benford.Roll_mad">[docs]</a><span class="k">class</span> <span class="nc">Roll_mad</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the MAD to sequential subsets of the Series, returning another</span>
<span class="sd">    Series.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: tells which test to use. 1: Fisrt Digits; 2: First Two Digits;</span>
<span class="sd">            3: First Three Digits; 22: Second Digit; and -2: Last Two Digits.</span>
<span class="sd">        window: size of the subset to be used.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">Exp</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">prep_to_roll</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

        <span class="n">Series</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">test</span><span class="p">]]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mad_to_roll</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span> <span class="n">ind</span><span class="p">),</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#: the test (F1D, SD, F2D...) used for the MAD calculation and critical values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>

<div class="viewcode-block" id="Roll_mad.show_plot"><a class="viewcode-back" href="../../api.html#benford.benford.Roll_mad.show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Shows the rolling MAD plot</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            figsize: the figure dimensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mad_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;af&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mad_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;h2&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">mad_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Roll_mse"><a class="viewcode-back" href="../../api.html#benford.benford.Roll_mse">[docs]</a><span class="k">class</span> <span class="nc">Roll_mse</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the MSE to sequential subsets of the Series, returning another</span>
<span class="sd">    Series.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: tells which test to use. 1: Fisrt Digits; 2: First Two Digits;</span>
<span class="sd">            3: First Three Digits; 22: Second Digit; and -2: Last Two Digits.</span>
<span class="sd">        window: size of the subset to be used.</span>
<span class="sd">            decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. &#39;pos&#39;: only the positive</span>
<span class="sd">            entries; &#39;neg&#39;: only negative entries; &#39;all&#39;: all entries but zeros.</span>
<span class="sd">            Defaults to &#39;all&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">Exp</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">prep_to_roll</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

        <span class="n">Series</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">test</span><span class="p">]]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span>
            <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mse_to_roll</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span> <span class="n">ind</span><span class="p">),</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Roll_mse.show_plot"><a class="viewcode-back" href="../../api.html#benford.benford.Roll_mse.show_plot">[docs]</a>    <span class="k">def</span> <span class="nf">show_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;Shows the rolling MSE plot</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            figsize: the figure dimensions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="first_digits"><a class="viewcode-back" href="../../api.html#benford.benford.first_digits">[docs]</a><span class="k">def</span> <span class="nf">first_digits</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">digs</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the Benford First Digits test on the series of</span>
<span class="sd">    numbers provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. &#39;pos&#39;: only the positive</span>
<span class="sd">            entries; &#39;neg&#39;: only negative entries; &#39;all&#39;: all entries but zeros.</span>
<span class="sd">            Defaults to &#39;all&#39;.</span>
<span class="sd">        digs: number of first digits to consider. Must be 1 (first digit),</span>
<span class="sd">            2 (first two digits) or 3 (first three digits).</span>
<span class="sd">        verbose: tells the number of registries that are being subjected to</span>
<span class="sd">            the analysis and returns tha analysis DataFrame sorted by the</span>
<span class="sd">            highest Z score down. Defaults to True.</span>
<span class="sd">        MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">            found and the expected distributions; defaults to False.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show. Defaults to None.</span>
<span class="sd">        high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">            according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">            which will highlight only values higher than the expexted</span>
<span class="sd">            frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">            negative); and an integer, which will use the first n entries,</span>
<span class="sd">            positive and negative, regardless of whether Z is higher than</span>
<span class="sd">            the confidence or not.</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">            the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">        MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        chi_square: calculates the chi_square statistic of the sample and</span>
<span class="sd">            compares it with a critical value, according to the confidence</span>
<span class="sd">            level chosen and the series&#39;s degrees of freedom. Defaults to</span>
<span class="sd">            False. Requires confidence != None.</span>
<span class="sd">        KS: calculates the Kolmogorov-Smirnov test, comparing the cumulative</span>
<span class="sd">            distribution of the sample with the Benford&#39;s, according to the</span>
<span class="sd">            confidence level chosen. Defaults to False. Requires confidence</span>
<span class="sd">            != None.</span>
<span class="sd">        show_plot: draws the test plot.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">            the differences if the confidence is not None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">first_digits</span><span class="p">(</span><span class="n">digs</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                             <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span>
                             <span class="n">chi_square</span><span class="o">=</span><span class="n">chi_square</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="n">KS</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
                             <span class="n">ret_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_score&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Z_score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="second_digit"><a class="viewcode-back" href="../../api.html#benford.benford.second_digit">[docs]</a><span class="k">def</span> <span class="nf">second_digit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the Benford Second Digits test on the series of</span>
<span class="sd">    numbers provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. &#39;pos&#39;: only the positive</span>
<span class="sd">            entries; &#39;neg&#39;: only negative entries; &#39;all&#39;: all entries but zeros.</span>
<span class="sd">            Defaults to &#39;all&#39;.</span>
<span class="sd">        verbose: tells the number of registries that are being subjected to</span>
<span class="sd">            the analysis and returns tha analysis DataFrame sorted by the</span>
<span class="sd">            highest Z score down. Defaults to True.</span>
<span class="sd">        MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">            found and the expected distributions; defaults to False.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show. Defaults to None.</span>
<span class="sd">        high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">            according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">            which will highlight only values higher than the expexted</span>
<span class="sd">            frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">            negative); and an integer, which will use the first n entries,</span>
<span class="sd">            positive and negative, regardless of whether Z is higher than</span>
<span class="sd">            the confidence or not.</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">            the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">        MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        chi_square: calculates the chi_square statistic of the sample and</span>
<span class="sd">            compares it with a critical value, according to the confidence</span>
<span class="sd">            level chosen and the series&#39;s degrees of freedom. Defaults to</span>
<span class="sd">            False. Requires confidence != None.</span>
<span class="sd">        KS: calculates the Kolmogorov-Smirnov test, comparing the cumulative</span>
<span class="sd">            distribution of the sample with the Benford&#39;s, according to the</span>
<span class="sd">            confidence level chosen. Defaults to False. Requires confidence</span>
<span class="sd">            != None.</span>
<span class="sd">        show_plot: draws the test plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">            the differences if the confidence is not None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">second_digit</span><span class="p">(</span><span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                             <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span>
                             <span class="n">chi_square</span><span class="o">=</span><span class="n">chi_square</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="n">KS</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span>
                             <span class="n">ret_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_score&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Z_score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="last_two_digits"><a class="viewcode-back" href="../../api.html#benford.benford.last_two_digits">[docs]</a><span class="k">def</span> <span class="nf">last_two_digits</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the Last Two Digits test on the series of</span>
<span class="sd">    numbers provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column,with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. &#39;pos&#39;: only the positive</span>
<span class="sd">            entries; &#39;neg&#39;: only negative entries; &#39;all&#39;: all entries but zeros.</span>
<span class="sd">            Defaults to &#39;all&#39;.</span>
<span class="sd">        verbose: tells the number of registries that are being subjected to</span>
<span class="sd">            the analysis and returns tha analysis DataFrame sorted by the</span>
<span class="sd">            highest Z score down. Defaults to True.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show. Defaults to None.</span>
<span class="sd">        high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">            according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">            which will highlight only values higher than the expexted</span>
<span class="sd">            frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">            negative); and an integer, which will use the first n entries,</span>
<span class="sd">            positive and negative, regardless of whether Z is higher than</span>
<span class="sd">            the confidence or not.</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">            the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">        MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">            found and the expected distributions; defaults to False.</span>
<span class="sd">        MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        chi_square: calculates the chi_square statistic of the sample and</span>
<span class="sd">            compares it with a critical value, according to the confidence</span>
<span class="sd">            level chosen and the series&#39;s degrees of freedom. Defaults to</span>
<span class="sd">            False. Requires confidence != None.</span>
<span class="sd">        KS: calculates the Kolmogorov-Smirnov test, comparing the cumulative</span>
<span class="sd">            distribution of the sample with the Benford&#39;s, according to the</span>
<span class="sd">            confidence level chosen. Defaults to False. Requires confidence</span>
<span class="sd">            != None.</span>
<span class="sd">        show_plot: draws the test plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with the Expected and Found proportions, and the Z scores of</span>
<span class="sd">            the differences if the confidence is not None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">last_two_digits</span><span class="p">(</span><span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                                <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span>
                                <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span> <span class="n">chi_square</span><span class="o">=</span><span class="n">chi_square</span><span class="p">,</span> <span class="n">KS</span><span class="o">=</span><span class="n">KS</span><span class="p">,</span>
                                <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span> <span class="n">ret_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">confidence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_score&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Z_score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="s1">&#39;Found&#39;</span><span class="p">,</span> <span class="s1">&#39;Expected&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="mantissas"><a class="viewcode-back" href="../../api.html#benford.benford.mantissas">[docs]</a><span class="k">def</span> <span class="nf">mantissas</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arc_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extraxts the mantissas of the records logarithms</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence to compute mantissas from, numpy 1D array, pandas Series</span>
<span class="sd">            of pandas DataFrame column.</span>
<span class="sd">        report: prints the mamtissas mean, variance, skewness and kurtosis</span>
<span class="sd">            for the sequence studied, along with reference values.</span>
<span class="sd">        show_plot: plots the ordered mantissas and a line with the expected</span>
<span class="sd">            inclination. Defaults to True.</span>
<span class="sd">        arc_test: draws the Arc Test plot. Defaluts to True.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Series with the data mantissas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="n">mant</span> <span class="o">=</span> <span class="n">Mantissas</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
        <span class="n">mant</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
        <span class="n">mant</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">arc_test</span><span class="p">:</span>
        <span class="n">mant</span><span class="o">.</span><span class="n">arc_test</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mant</span></div>


<div class="viewcode-block" id="summation"><a class="viewcode-back" href="../../api.html#benford.benford.summation">[docs]</a><span class="k">def</span> <span class="nf">summation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">digs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the Summation test. In a Benford series, the sums of the</span>
<span class="sd">    entries begining with the same digits tends to be the same.</span>
<span class="sd">    Works only with the First Digits (1, 2 or 3) test.</span>

<span class="sd">    Args:</span>
<span class="sd">        digs: tells the first digits to use: 1- first; 2- first two;</span>
<span class="sd">            3- first three. Defaults to 2.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        top: choses how many top values to show. Defaults to 20.</span>
<span class="sd">        show_plot: plots the results. Defaults to True.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with the Summation test, whether sorted in descending order</span>
<span class="sd">            (if verbose == True) or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">summation</span><span class="p">(</span><span class="n">digs</span><span class="o">=</span><span class="n">digs</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                          <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">,</span> <span class="n">ret_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;AbsDif&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="mad"><a class="viewcode-back" href="../../api.html#benford.benford.mad">[docs]</a><span class="k">def</span> <span class="nf">mad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the Mean Absolute Deviation of the Series</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: informs which base test to use for the mad.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: the Mean Absolute Deviation of the Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">first_digits</span><span class="p">(</span><span class="n">digs</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">second_digit</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">last_two_digits</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start</span><span class="o">.</span><span class="n">MAD</span></div>


<div class="viewcode-block" id="mse"><a class="viewcode-back" href="../../api.html#benford.benford.mse">[docs]</a><span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the Mean Squared Error of the Series</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: informs which base test to use for the mad.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: the Mean Squared Error of the Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">first_digits</span><span class="p">(</span><span class="n">digs</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">second_digit</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span><span class="o">.</span><span class="n">last_two_digits</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start</span><span class="o">.</span><span class="n">MSE</span></div>


<div class="viewcode-block" id="mad_summ"><a class="viewcode-back" href="../../api.html#benford.benford.mad_summ">[docs]</a><span class="k">def</span> <span class="nf">mad_summ</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the Mean Absolute Deviation of the Summation Test</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: informs which base test to use for the summation mad.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        float: the Mean Absolute Deviation of the Summation Test</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_check_digs_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="o">.</span><span class="n">ZN</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">test</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">test</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">((</span><span class="n">log10</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">ZN</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                                <span class="nb">int</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">test</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                                    <span class="nb">int</span><span class="p">)</span>
    <span class="n">li</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">test</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">digs_dict</span><span class="p">[</span><span class="n">test</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ZN</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">ZN</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">li</span><span class="p">))</span></div>


<div class="viewcode-block" id="rolling_mad"><a class="viewcode-back" href="../../api.html#benford.benford.rolling_mad">[docs]</a><span class="k">def</span> <span class="nf">rolling_mad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the MAD to sequential subsets of the records.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: tells which test to use. 1: Fisrt Digits; 2: First Two Digits;</span>
<span class="sd">            3: First Three Digits; 22: Second Digit; and -2: Last Two Digits.</span>
<span class="sd">        window: size of the subset to be used.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">        show_plot: draws the test plot.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Series with sequentially computed MADs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="n">r_mad</span> <span class="o">=</span> <span class="n">Roll_mad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
        <span class="n">r_mad</span><span class="o">.</span><span class="n">show_plot</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r_mad</span></div>


<div class="viewcode-block" id="rolling_mse"><a class="viewcode-back" href="../../api.html#benford.benford.rolling_mse">[docs]</a><span class="k">def</span> <span class="nf">rolling_mse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Applies the MSE to sequential subsets of the records.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: tells which test to use. 1: Fisrt Digits; 2: First Two Digits;</span>
<span class="sd">            3: First Three Digits; 22: Second Digit; and -2: Last Two Digits.</span>
<span class="sd">        window: size of the subset to be used.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">        show_plot: draws the test plot.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Series with sequentially computed MSEs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_mse</span> <span class="o">=</span> <span class="n">Roll_mse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
        <span class="n">r_mse</span><span class="o">.</span><span class="n">show_plot</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">r_mse</span></div>


<div class="viewcode-block" id="duplicates"><a class="viewcode-back" href="../../api.html#benford.benford.duplicates">[docs]</a><span class="k">def</span> <span class="nf">duplicates</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">top_Rep</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs a duplicates test and maps the duplicates count in descending</span>
<span class="sd">    order.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence to take the duplicates from. pandas Series or</span>
<span class="sd">            numpy Ndarray.</span>
<span class="sd">        verbose: tells how many duplicated entries were found and prints the</span>
<span class="sd">            top numbers according to the top_Rep argument. Defaluts to True.</span>
<span class="sd">        top_Rep: chooses how many duplicated entries will be</span>
<span class="sd">            shown withe the top repititions. int or None. Defaluts to 20.</span>
<span class="sd">            If None, returns al the ordered repetitions.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame with the duplicated records and their respective counts</span>
<span class="sd">    </span>
<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the `top_Rep` arg is not int or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">top_Rep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_Rep</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The top_Rep argument must be an int or None.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">data must be a numpy Ndarray or a pandas Series.&#39;</span><span class="p">)</span>

    <span class="n">dup</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="n">dup_count</span> <span class="o">=</span> <span class="n">dup</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

    <span class="n">dup_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Entries&#39;</span><span class="p">]</span>
    <span class="n">dup_count</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Count&#39;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Found {len(dup_count)} duplicated entries.</span><span class="se">\n</span><span class="s1">&#39;</span>
              <span class="sa">f</span><span class="s1">&#39;The entries with the </span><span class="si">{top_Rep}</span><span class="s1"> highest repitition counts are:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dup_count</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_Rep</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">dup_count</span></div>


<div class="viewcode-block" id="second_order"><a class="viewcode-back" href="../../api.html#benford.benford.second_order">[docs]</a><span class="k">def</span> <span class="nf">second_order</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">confidence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">limit_N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the chosen test after subtracting the ordered sequence by itself.</span>
<span class="sd">    Hence Second Order.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: sequence of numbers to be evaluated. Must be a numpy 1D array,</span>
<span class="sd">            a pandas Series or a pandas DataFrame column, with values being</span>
<span class="sd">            integers or floats.</span>
<span class="sd">        test: the test to be performed - 1 or &#39;F1D&#39;: First Digit; 2 or &#39;F2D&#39;:</span>
<span class="sd">            First Two Digits; 3 or &#39;F3D&#39;: First three Digits; 22 or &#39;SD&#39;:</span>
<span class="sd">            Second Digits; -2 or &#39;L2D&#39;: Last Two Digits.</span>
<span class="sd">        decimals: number of decimal places to consider. Defaluts to 2.</span>
<span class="sd">            If integers, set to 0. If set to -infer-, it will remove the zeros</span>
<span class="sd">            and consider up to the fifth decimal place to the right, but will</span>
<span class="sd">            loose performance.</span>
<span class="sd">        sign: tells which portion of the data to consider. pos: only the positive</span>
<span class="sd">            entries; neg: only negative entries; all: all entries but zeros.</span>
<span class="sd">            Defaults to all.</span>
<span class="sd">        verbose: tells the number of registries that are being subjected to</span>
<span class="sd">            the analysis and returns tha analysis DataFrame sorted by the</span>
<span class="sd">            highest Z score down. Defaults to True.</span>
<span class="sd">        MAD: calculates the Mean Absolute Difference between the</span>
<span class="sd">            found and the expected distributions; defaults to False.</span>
<span class="sd">        confidence: confidence level to draw lower and upper limits when</span>
<span class="sd">            plotting and to limit the top deviations to show. Defaults to None.</span>
<span class="sd">        high_Z: chooses which Z scores to be used when displaying results,</span>
<span class="sd">            according to the confidence level chosen. Defaluts to &#39;pos&#39;,</span>
<span class="sd">            which will highlight only values higher than the expexted</span>
<span class="sd">            frequencies; &#39;all&#39; will highlight both extremes (positive and</span>
<span class="sd">            negative); and an integer, which will use the first n entries,</span>
<span class="sd">            positive and negative, regardless of whether Z is higher than</span>
<span class="sd">            the confidence or not.</span>
<span class="sd">        limit_N: sets a limit to N as the sample size for the calculation of</span>
<span class="sd">            the Z scores if the sample is too big. Defaults to None.</span>
<span class="sd">        MSE: calculates the Mean Square Error of the sample; defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        chi_square: calculates the chi_square statistic of the sample and</span>
<span class="sd">            compares it with a critical value, according to the confidence</span>
<span class="sd">            level chosen and the series&#39;s degrees of freedom. Defaults to</span>
<span class="sd">            False. Requires confidence != None.</span>
<span class="sd">        KS: calculates the Kolmogorov-Smirnov test, comparing the cumulative</span>
<span class="sd">            distribution of the sample with the Benford&#39;s, according to the</span>
<span class="sd">            confidence level chosen. Defaults to False. Requires confidence</span>
<span class="sd">            != None.</span>
<span class="sd">        show_plot: draws the test plot.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        DataFrame of the test chosen, but applied on Second Order pre-</span>
<span class="sd">            processed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">_check_test_</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

    <span class="n">verbose</span> <span class="o">=</span> <span class="n">_deprecate_inform_</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span> <span class="n">inform</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">Source</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span>
                  <span class="n">sec_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">test</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">first_digits</span><span class="p">(</span><span class="n">digs</span><span class="o">=</span><span class="n">test</span><span class="p">,</span> <span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span>
                          <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                          <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">second_digit</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                          <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">last_two_digits</span><span class="p">(</span><span class="n">MAD</span><span class="o">=</span><span class="n">MAD</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">,</span> <span class="n">high_Z</span><span class="o">=</span><span class="n">high_Z</span><span class="p">,</span>
                             <span class="n">limit_N</span><span class="o">=</span><span class="n">limit_N</span><span class="p">,</span> <span class="n">MSE</span><span class="o">=</span><span class="n">MSE</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Marcel Milcent

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>